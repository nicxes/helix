import Image from "next/image";
import { Transition } from '@headlessui/react';
import { signOut, useSession } from "next-auth/react";

export default function Userbox({ balance = 0, bagCount = 0 }: { balance?: number, bagCount?: number }) {
  const { data: session } = useSession();

  const handleLogout = () => {
    signOut();
  };

  return (
    <div className="flex items-center justify-end gap-3">
      <div className="flex items-center gap-0.5">
        <button 
          onClick={handleLogout}
          className="bg-white/5 rounded-l h-10 py-4 px-2.5 flex items-center justify-center gap-2.5 hover:bg-white/10 transition duration-150 ease-in-out"
          title="Click to logout"
        >
          <Image
            src="/images/avatar.png"
            alt="avatar"
            width={28}
            height={28}
            className="size-7"
          />

          <div>
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M9.27028 13.2556L4.21434 8.19969C4.1446 8.12995 4.09253 8.05464 4.05813 7.97374C4.02372 7.89285 4.00606 7.80544 4.00513 7.71153C4.00513 7.52557 4.06929 7.36285 4.1976 7.22337C4.32592 7.0839 4.49422 7.01416 4.7025 7.01416H15.3025C15.5118 7.01416 15.6805 7.0839 15.8088 7.22337C15.9372 7.36285 16.0008 7.52557 15.9999 7.71153C15.9999 7.75802 15.9302 7.92074 15.7907 8.19969L10.7348 13.2556C10.6185 13.3719 10.5023 13.4532 10.3861 13.4997C10.2698 13.5462 10.142 13.5695 10.0025 13.5695C9.86305 13.5695 9.7352 13.5462 9.61897 13.4997C9.50274 13.4532 9.38651 13.3719 9.27028 13.2556Z" fill="white" fillOpacity="0.56"/>
            </svg>
          </div>
        </button>

        {/* Balance */}
        <div className="relative bg-white/5 rounded-tr h-10 py-4 px-2.5 flex items-center justify-center gap-0.5 after:absolute after:right-0 after:bottom-0 after:bg-background after:size-4 clip-polygon">
          {balance.toLocaleString()}
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <mask id="c" fill="white">
              <path d="M10 2.5C14.1421 2.5 17.5 5.85786 17.5 10C17.5 14.1421 14.1421 17.5 10 17.5C5.85786 17.5 2.5 14.1421 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5ZM5.94238 6.10645C5.39559 6.1077 5.12112 6.77754 5.50586 7.17188L7.83594 9.55957C8.07357 9.80319 8.07359 10.1958 7.83594 10.4395L5.49219 12.8418C5.10694 13.2368 5.38295 13.9068 5.93066 13.9062L7.68359 13.9033C7.84769 13.903 8.00468 13.8361 8.12012 13.7178L9.56836 12.2334C9.80945 11.9864 10.2031 11.9866 10.4443 12.2334L11.8857 13.71C12.0017 13.8288 12.1594 13.8957 12.3242 13.8955L14.0713 13.8926C14.6181 13.8914 14.8925 13.2225 14.5078 12.8281L8.12793 6.28906C8.01198 6.17037 7.85419 6.10328 7.68945 6.10352L5.94238 6.10645ZM12.2012 6.09668C12.1191 6.09682 12.0402 6.13025 11.9824 6.18945L11.4043 6.78125C11.2854 6.90306 11.2854 7.09987 11.4043 7.22168L12.7129 8.5625C12.8334 8.68581 13.0298 8.68583 13.1504 8.5625L14.459 7.22168C14.5778 7.09987 14.5778 6.90306 14.459 6.78125L13.8779 6.18652C13.82 6.12731 13.7414 6.09373 13.6592 6.09375L12.2012 6.09668Z"/>
            </mask>
            <path d="M10 2.5C14.1421 2.5 17.5 5.85786 17.5 10C17.5 14.1421 14.1421 17.5 10 17.5C5.85786 17.5 2.5 14.1421 2.5 10C2.5 5.85786 5.85786 2.5 10 2.5ZM5.94238 6.10645C5.39559 6.1077 5.12112 6.77754 5.50586 7.17188L7.83594 9.55957C8.07357 9.80319 8.07359 10.1958 7.83594 10.4395L5.49219 12.8418C5.10694 13.2368 5.38295 13.9068 5.93066 13.9062L7.68359 13.9033C7.84769 13.903 8.00468 13.8361 8.12012 13.7178L9.56836 12.2334C9.80945 11.9864 10.2031 11.9866 10.4443 12.2334L11.8857 13.71C12.0017 13.8288 12.1594 13.8957 12.3242 13.8955L14.0713 13.8926C14.6181 13.8914 14.8925 13.2225 14.5078 12.8281L8.12793 6.28906C8.01198 6.17037 7.85419 6.10328 7.68945 6.10352L5.94238 6.10645ZM12.2012 6.09668C12.1191 6.09682 12.0402 6.13025 11.9824 6.18945L11.4043 6.78125C11.2854 6.90306 11.2854 7.09987 11.4043 7.22168L12.7129 8.5625C12.8334 8.68581 13.0298 8.68583 13.1504 8.5625L14.459 7.22168C14.5778 7.09987 14.5778 6.90306 14.459 6.78125L13.8779 6.18652C13.82 6.12731 13.7414 6.09373 13.6592 6.09375L12.2012 6.09668Z" fill="#F2568D"/>
            <path d="M5.94238 6.10645L5.93609 2.35645L5.93375 2.35646L5.94238 6.10645ZM5.50586 7.17188L2.82177 9.79068L2.82203 9.79095L5.50586 7.17188ZM7.83594 9.55957L10.5204 6.94115L10.5198 6.9405L7.83594 9.55957ZM7.83594 10.4395L10.5201 13.0582L10.5202 13.0581L7.83594 10.4395ZM5.49219 12.8418L2.80801 10.2231L2.80742 10.2237L5.49219 12.8418ZM5.93066 13.9062L5.93448 17.6562L5.93693 17.6562L5.93066 13.9062ZM7.68359 13.9033L7.68986 17.6533L7.69184 17.6533L7.68359 13.9033ZM8.12012 13.7178L10.8042 16.3366L10.8042 16.3366L8.12012 13.7178ZM9.56836 12.2334L6.88461 9.61424L6.88424 9.61462L9.56836 12.2334ZM10.4443 12.2334L13.1277 9.61389L13.1264 9.61252L10.4443 12.2334ZM11.8857 13.71L14.5698 11.0912L14.5691 11.0904L11.8857 13.71ZM12.3242 13.8955L12.3289 17.6455L12.3305 17.6455L12.3242 13.8955ZM14.0713 13.8926L14.0776 17.6426L14.0795 17.6426L14.0713 13.8926ZM14.5078 12.8281L17.1923 10.2097L17.1919 10.2093L14.5078 12.8281ZM8.12793 6.28906L10.812 3.67028L10.8103 3.66854L8.12793 6.28906ZM7.68945 6.10352L7.68406 2.35352L7.68316 2.35352L7.68945 6.10352ZM12.2012 6.09668L12.2074 9.84667L12.2087 9.84667L12.2012 6.09668ZM11.9824 6.18945L14.6649 8.80994L14.6665 8.80826L11.9824 6.18945ZM11.4043 6.78125L8.72184 4.16077L8.72021 4.16244L11.4043 6.78125ZM11.4043 7.22168L8.72021 9.84049L8.72059 9.84088L11.4043 7.22168ZM12.7129 8.5625L10.0292 11.1817L10.0315 11.1841L12.7129 8.5625ZM13.1504 8.5625L15.8321 11.1837L15.8341 11.1817L13.1504 8.5625ZM14.459 7.22168L17.1427 9.84088L17.1431 9.84049L14.459 7.22168ZM14.459 6.78125L17.1431 4.16244L17.1413 4.16061L14.459 6.78125ZM13.8779 6.18652L16.5602 3.56588L16.5595 3.56509L13.8779 6.18652ZM13.6592 6.09375L13.6584 2.34374L13.6516 2.34376L13.6592 6.09375ZM10 2.5V6.25C12.0711 6.25 13.75 7.92893 13.75 10H17.5H21.25C21.25 3.7868 16.2132 -1.25 10 -1.25V2.5ZM17.5 10H13.75C13.75 12.0711 12.0711 13.75 10 13.75V17.5V21.25C16.2132 21.25 21.25 16.2132 21.25 10H17.5ZM10 17.5V13.75C7.92893 13.75 6.25 12.0711 6.25 10H2.5H-1.25C-1.25 16.2132 3.7868 21.25 10 21.25V17.5ZM2.5 10H6.25C6.25 7.92893 7.92893 6.25 10 6.25V2.5V-1.25C3.7868 -1.25 -1.25 3.7868 -1.25 10H2.5ZM5.94238 6.10645L5.93375 2.35646C1.95919 2.3656 0.201694 7.1053 2.82177 9.79068L5.50586 7.17188L8.18995 4.55307C10.0405 6.44979 8.83198 9.8498 5.95101 9.85644L5.94238 6.10645ZM5.50586 7.17188L2.82203 9.79095L5.1521 12.1786L7.83594 9.55957L10.5198 6.9405L8.18969 4.5528L5.50586 7.17188ZM7.83594 9.55957L5.15147 12.178C3.96858 10.9653 3.96816 9.03401 5.15167 7.82083L7.83594 10.4395L10.5202 13.0581C12.179 11.3577 12.1786 8.64112 10.5204 6.94115L7.83594 9.55957ZM7.83594 10.4395L5.15176 7.82074L2.80801 10.2231L5.49219 12.8418L8.17637 15.4605L10.5201 13.0582L7.83594 10.4395ZM5.49219 12.8418L2.80742 10.2237C0.182904 12.915 1.95446 17.6603 5.93448 17.6562L5.93066 13.9062L5.92685 10.1563C8.81145 10.1533 10.031 13.5587 8.17695 15.4599L5.49219 12.8418ZM5.93066 13.9062L5.93693 17.6562L7.68986 17.6533L7.68359 13.9033L7.67733 10.1533L5.9244 10.1563L5.93066 13.9062ZM7.68359 13.9033L7.69184 17.6533C8.87536 17.6507 9.99325 17.1678 10.8042 16.3366L8.12012 13.7178L5.43603 11.099C6.0161 10.5044 6.82003 10.1552 7.67534 10.1533L7.68359 13.9033ZM8.12012 13.7178L10.8042 16.3366L12.2525 14.8522L9.56836 12.2334L6.88424 9.61462L5.436 11.099L8.12012 13.7178ZM9.56836 12.2334L12.2521 14.8526C11.02 16.1151 8.99049 16.1112 7.76226 14.8543L10.4443 12.2334L13.1264 9.61252C11.4158 7.86193 8.59891 7.85766 6.88461 9.61424L9.56836 12.2334ZM10.4443 12.2334L7.76093 14.8529L9.20234 16.3295L11.8857 13.71L14.5691 11.0904L13.1277 9.61389L10.4443 12.2334ZM11.8857 13.71L9.20165 16.3288C10.0156 17.163 11.1392 17.647 12.3289 17.6455L12.3242 13.8955L12.3195 10.1455C13.1796 10.1444 13.9878 10.4946 14.5698 11.0912L11.8857 13.71ZM12.3242 13.8955L12.3305 17.6455L14.0776 17.6426L14.0713 13.8926L14.065 10.1426L12.3179 10.1455L12.3242 13.8955ZM14.0713 13.8926L14.0795 17.6426C18.0515 17.6339 19.8136 12.8972 17.1923 10.2097L14.5078 12.8281L11.8233 15.4465C9.9713 13.5477 11.1847 10.1489 14.0631 10.1426L14.0713 13.8926ZM14.5078 12.8281L17.1919 10.2093L10.812 3.67028L8.12793 6.28906L5.44381 8.90784L11.8237 15.4469L14.5078 12.8281ZM8.12793 6.28906L10.8103 3.66854C9.99873 2.83775 8.87639 2.3518 7.68406 2.35352L7.68945 6.10352L7.69485 9.85351C6.83199 9.85475 6.02522 9.50299 5.44551 8.90958L8.12793 6.28906ZM7.68945 6.10352L7.68316 2.35352L5.93609 2.35645L5.94238 6.10645L5.94867 9.85644L7.69574 9.85351L7.68945 6.10352ZM12.2012 6.09668L12.195 2.34668C11.0969 2.3485 10.055 2.79507 9.29833 3.57064L11.9824 6.18945L14.6665 8.80826C14.0253 9.46544 13.1412 9.84513 12.2074 9.84667L12.2012 6.09668ZM11.9824 6.18945L9.29997 3.56897L8.72184 4.16077L11.4043 6.78125L14.0868 9.40173L14.6649 8.80994L11.9824 6.18945ZM11.4043 6.78125L8.72021 4.16244C7.18014 5.7409 7.18014 8.26203 8.72021 9.84049L11.4043 7.22168L14.0884 4.60287C15.3907 5.9377 15.3907 8.06523 14.0884 9.40006L11.4043 6.78125ZM11.4043 7.22168L8.72059 9.84088L10.0292 11.1817L12.7129 8.5625L15.3966 5.9433L14.088 4.60248L11.4043 7.22168ZM12.7129 8.5625L10.0315 11.1841C11.6227 12.8116 14.2402 12.8125 15.8321 11.1837L13.1504 8.5625L10.4686 5.9413C11.8195 4.5592 14.0442 4.56002 15.3943 5.94094L12.7129 8.5625ZM13.1504 8.5625L15.8341 11.1817L17.1427 9.84088L14.459 7.22168L11.7753 4.60248L10.4667 5.9433L13.1504 8.5625ZM14.459 7.22168L17.1431 9.84049C18.6831 8.26203 18.6831 5.7409 17.1431 4.16244L14.459 6.78125L11.7749 9.40006C10.4725 8.06523 10.4725 5.9377 11.7749 4.60287L14.459 7.22168ZM14.459 6.78125L17.1413 4.16061L16.5602 3.56588L13.8779 6.18652L11.1956 8.80716L11.7767 9.40189L14.459 6.78125ZM13.8779 6.18652L16.5595 3.56509C15.8091 2.7975 14.7689 2.34351 13.6584 2.34375L13.6592 6.09375L13.66 9.84375C12.7138 9.84395 11.831 9.45713 11.1964 8.80796L13.8779 6.18652ZM13.6592 6.09375L13.6516 2.34376L12.1936 2.34669L12.2012 6.09668L12.2087 9.84667L13.6667 9.84374L13.6592 6.09375Z" fill="#F2568D" mask="url(#c)"/>
          </svg>
        </div>
      </div>

      {/* Bag */}
      <button className="relative size-10 flex items-center justify-center cursor-pointer">
        <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fillRule="evenodd" clipRule="evenodd" d="M14 3C11.5838 3 9.625 4.95876 9.625 7.375H7.875C5.942 7.375 4.375 8.942 4.375 10.875V20.5C4.375 22.433 5.942 24 7.875 24H20.125C22.058 24 23.625 22.433 23.625 20.5V10.875C23.625 8.942 22.058 7.375 20.125 7.375H18.375C18.375 4.95876 16.4162 3 14 3ZM16.625 7.375C16.625 5.92526 15.4498 4.75 14 4.75C12.5502 4.75 11.375 5.92526 11.375 7.375H16.625ZM9.625 9.125H7.875C6.9085 9.125 6.125 9.90847 6.125 10.875V20.5C6.125 21.4665 6.9085 22.25 7.875 22.25H20.125C21.0915 22.25 21.875 21.4665 21.875 20.5V10.875C21.875 9.90847 21.0915 9.125 20.125 9.125H18.375H9.625ZM11.375 10.875C11.375 12.3248 12.5502 13.5 14 13.5C15.4498 13.5 16.625 12.3248 16.625 10.875H18.375C18.375 13.2912 16.4162 15.25 14 15.25C11.5838 15.25 9.625 13.2912 9.625 10.875H11.375Z" fill="white" fillOpacity="0.56"/>
        </svg>

        {/* Bag count */}
        <Transition show={bagCount > 0}>
          <span className="absolute top-0 right-0 bg-alert rounded size-4 text-[#111111] font-bold text-xs uppercase flex items-center justify-center transition duration-300 ease-in data-closed:opacity-0">
            {bagCount}
          </span>
        </Transition>
      </button>
    </div>
  )
}
